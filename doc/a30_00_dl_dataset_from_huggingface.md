# カスタマーサポートFAQデータRAG前処理アプリ設計書

## 1. 概要書

### 1.1 処理の概要
カスタマーサポートFAQデータのCSVファイルを読み込み、RAG（Retrieval-Augmented Generation）用に最適化された前処理を行うStreamlitアプリケーション。データのクレンジング、正規化、結合を実行し、Vector Store用のテキストファイルとして出力する。

**主要機能:**
- CSVファイルのアップロード・読み込み
- データ品質検証とサポートデータ特有の分析
- テキストクレンジングと正規化
- 複数列の結合によるRAG用テキスト生成
- トークン使用量とコスト推定
- 処理済みデータのダウンロード・保存

### 1.2 mainの処理の流れ
初期設定
├─ データセットタイプ設定（customer_support_faq）
├─ ページ設定（タイトル、レイアウト等）
└─ サイドバーヘッダー設定
サイドバー設定
├─ モデル選択UI
├─ モデル情報表示
├─ 前処理設定（結合オプション、検証表示）
└─ サポートデータ特有設定
メインエリア処理
├─ モデル情報表示
├─ ファイルアップロード UI
└─ ファイル処理分岐
├─ ファイルあり → 4. データ処理へ
└─ ファイルなし → サンプル表示
データ処理
├─ ファイル読み込み・セッション管理
├─ データプレビュー表示
├─ データ検証・分析表示
└─ 前処理実行分岐
├─ 実行ボタン押下 → 5. 前処理実行へ
└─ 未実行 → 待機
前処理実行
├─ RAGデータ前処理
├─ 処理後データ表示
├─ 統計情報表示
├─ トークン使用量推定
└─ サポート特有分析
ダウンロード・保存
├─ ダウンロード用データ準備
├─ ブラウザダウンロード機能
└─ ローカルファイル保存機能
付加機能
├─ 使用方法説明表示
└─ デバッグ情報表示（オプション）
## 2. 関数一覧

| 関数名 | 処理概要 |
|--------|----------|
| `validate_customer_support_data_specific()` | カスタマーサポートFAQ特有のデータ検証・分析 |
| `main()` | アプリケーションのメイン処理統括 |

### 2.1 helper_rag.py からのインポート関数

| 関数名 | 処理概要 |
|--------|----------|
| `setup_page_config()` | Streamlitページ設定の初期化 |
| `setup_page_header()` | ページヘッダーの設定 |
| `setup_sidebar_header()` | サイドバーヘッダーの設定 |
| `select_model()` | モデル選択UI |
| `show_model_info()` | 選択モデル情報表示 |
| `load_dataset()` | CSVファイル読み込み・基本検証 |
| `process_rag_data()` | RAGデータ前処理実行 |
| `display_statistics()` | 処理前後統計情報表示 |
| `estimate_token_usage()` | トークン使用量推定 |
| `create_download_data()` | ダウンロード用データ作成 |
| `save_files_to_output()` | OUTPUTフォルダへの保存 |
| `show_usage_instructions()` | 使用方法説明表示 |

## 3. 関数の詳細設計書

### 3.1 validate_customer_support_data_specific()

**処理概要:**
カスタマーサポートFAQデータに特化した検証・分析を実行し、サポート関連用語の分析、回答長分析、疑問形質問の分析を行う。

**処理の流れ:**
サポート関連用語の存在確認
├─ キーワードリスト定義
├─ question列の存在確認
├─ 各行でキーワード検索
└─ 該当件数・割合計算
回答の長さ分析
├─ answer列の存在確認
├─ 文字数計算
├─ 平均長判定（50文字基準）
└─ 適切性評価
質問の種類分析
├─ 疑問詞リスト定義
├─ question列の疑問詞検索
├─ 疑問形質問カウント
└─ 割合計算
結果リスト生成
**IPO:**
- **INPUT:** `df` (pandas.DataFrame) - 検証対象データフレーム
- **PROCESS:** サポート用語分析、回答長分析、疑問形分析
- **OUTPUT:** `List[str]` - 分析結果メッセージリスト

### 3.2 main()

**処理概要:**
アプリケーション全体の統括処理。UI構築、ファイル処理、データ変換、結果出力までの一連の流れを管理する。

**処理の流れ:**
初期設定
├─ DATASET_TYPE設定
├─ ページ設定呼び出し
└─ ヘッダー設定呼び出し
サイドバー構築
├─ モデル選択UI
├─ 前処理設定UI
└─ データ特有設定UI
メインエリア構築
├─ モデル情報表示
└─ ファイルアップロードUI
ファイル処理制御
├─ ファイル存在判定
├─ セッション状態管理
├─ ファイル読み込み
├─ データ表示
└─ 検証結果表示
前処理制御
├─ 処理ボタン判定
├─ RAG前処理実行
├─ 結果データ保存
├─ 統計情報表示
└─ 特有分析実行
出力制御
├─ ダウンロードデータ準備
├─ ブラウザダウンロード
└─ ローカル保存
補助機能
├─ 使用方法表示
└─ デバッグ情報表示
**IPO:**
- **INPUT:**
  - Streamlit UI入力（ファイル、設定）
  - セッション状態
- **PROCESS:** UI制御、データ処理統括、状態管理
- **OUTPUT:**
  - Streamlit UI表示
  - 処理済みファイル
  - セッション状態更新

## 4. 不足情報の指摘

### 4.1 技術仕様の不足
1. **helper_rag.py の詳細仕様**
   - 各インポート関数の詳細なインターフェース
   - エラーハンドリングの仕様
   - パフォーマンス特性

2. **ファイル形式仕様**
   - CSVの詳細フォーマット（区切り文字、エンコーディング、改行コード）
   - 最大ファイルサイズ制限
   - 対応する文字セット

3. **セッション管理仕様**
   - セッション状態の有効期限
   - メモリ使用量制限
   - 同時セッション数制限

### 4.2 非機能要件の不足
1. **パフォーマンス要件**
   - 最大処理可能行数
   - 処理時間の上限
   - メモリ使用量制限

2. **セキュリティ要件**
   - アップロードファイルのスキャン
   - ファイル保存時の権限設定
   - 個人情報保護対応

3. **エラーハンドリング仕様**
   - エラー分類と対応
   - ログレベルと出力先
   - ユーザー通知方法

### 4.3 運用・保守仕様の不足
1. **ログ仕様**
   - ログレベル（DEBUG、INFO、WARNING、ERROR）
   - ログフォーマット
   - ログローテーション

2. **設定ファイル仕様**
   - 外部設定ファイルの有無
   - 環境別設定の切り替え
   - 設定変更時の反映方法

3. **デプロイメント仕様**
   - 依存関係の管理
   - 環境構築手順
   - バージョン管理方法
